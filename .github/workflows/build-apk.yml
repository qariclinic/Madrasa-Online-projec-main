name: Flutter CI/CD Build Fix

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    # 1. RUNNER FIX: 'runs-on' Ø§ÙˆØ± 'shell' Ø§ÛŒÚ© ÛÛŒ Ù„ÛŒÙˆÙ„ Ù¾Ø± ÛÛŒÚºÛ”
    runs-on: ubuntu-latest
    shell: sh # <--- ÛŒÛ Ø§Ø¨ Ø¯Ø±Ø³Øª Ø¬Ú¯Û Ù¾Ø± ÛÛ’Û”
    
    steps:
      # 2. Checkout the code
      - name: ğŸ“¦ Checkout repository
        uses: actions/checkout@v4

      # 3. Set up Flutter
      - name: âš™ï¸ Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.19.6' 
          channel: 'stable'

      # 4. Get dependencies 
      - name: ğŸ§© Run flutter pub get
        run: flutter pub get

      # 5. Run tests - Ø§Ú¯Ø± Ù¹ÛŒØ³Ù¹ ÚˆØ§Ø¦Ø±ÛŒÚ©Ù¹Ø±ÛŒ Ú©Ø§ Ù…Ø³Ø¦Ù„Û ÛÙˆ ØªÙˆ working-directory Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚºÛ”
      - name: ğŸ§ª Run tests
        run: flutter test
        # working-directory: ./flutter_project_folder # Ø§Ú¯Ø± Ø¢Ù¾ Ú©Ø§ Ù¾Ø±ÙˆØ¬ÛŒÚ©Ù¹ Ø³Ø¨ ÙÙˆÙ„ÚˆØ± Ù…ÛŒÚº ÛÛ’ ØªÙˆ ÛŒÛ Ù„Ø§Ø¦Ù† ÛŒÛØ§Úº Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚºÛ”

      # 6. Build Android APK
      - name: ğŸ—ï¸ Build Android APK
        run: flutter build apk --release

      # 7. Upload APK artifact
      - name: ğŸš€ Upload APK artifact
        uses: actions/upload-artifact@v4
        with:
          name: app-release-apk
          path: build/app/outputs/flutter-apk/app-release.apk # Ù¾ÙˆØ±Ø§ path Ø¯ÛŒÙ†Ø§ Ø¶Ø±ÙˆØ±ÛŒ ÛÛ’
