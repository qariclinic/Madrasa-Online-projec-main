name: Flutter CI/CD Build

# ÛŒÛ ÙˆØ±Ú© ÙÙ„Ùˆ ÛØ± Ø¨Ø§Ø± Ø¬Ø¨ 'main' Ø¨Ø±Ø§Ù†Ú† Ù¾Ø± Ú©ÙˆØ¦ÛŒ Ú©ÙˆÚˆ push ÛÙˆØªØ§ ÛÛ’ ØªÙˆ Ú†Ù„Û’ Ú¯Ø§Û”
on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

# GitHub Actions Ø±Ù†Ø± Ú©Ø§ Ø§Ù†ØªØ®Ø§Ø¨
jobs:
  build:
    runs-on: ubuntu-latest
    
    # ÛŒÛØ§Úº 'flutter_project_folder' Ú©Ùˆ Ø§Ù¾Ù†Û’ Ù¾Ø±Ø§Ø¬ÛŒÚ©Ù¹ Ú©Û’ Ù†Ø§Ù… Ø³Û’ ØªØ¨Ø¯ÛŒÙ„ Ú©Ø±ÛŒÚºÛ”
    # Ø§Ú¯Ø± pubspec.yaml Ø±ÙˆÙ¹ Ù…ÛŒÚº ÛÛ’ ØªÙˆ Ø§Ø³ Ù„Ø§Ø¦Ù† Ú©Ùˆ ÛÙ¹Ø§ Ø¯ÛŒÚºÛ”
    env:
      FLUTTER_PROJECT_PATH: flutter_project_folder 
      
    steps:
      - name: ğŸ“¦ Checkout repository
        uses: actions/checkout@v4

      - name: âš™ï¸ Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: 'stable'

      - name: âœ… Check Flutter installation
        run: flutter doctor -v
        
      - name: ğŸ” Get dependencies (pub get)
        run: flutter pub get
        # ÛŒÛØ§Úº Ù…Ø³Ø¦Ù„Û Ø­Ù„ Ú©ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’: 'working-directory' Ú©Ùˆ Ù¾Ø±Ø§Ø¬ÛŒÚ©Ù¹ ÙÙˆÙ„ÚˆØ± Ù¾Ø± Ø³ÛŒÙ¹ Ú©Ø±ÛŒÚºÛ”
        working-directory: ${{ env.FLUTTER_PROJECT_PATH }}
        
      - name: ğŸ§ª Run tests
        run: flutter test
        working-directory: ${{ env.FLUTTER_PROJECT_PATH }}

      - name: ğŸ—ï¸ Build Android App Bundle (AAB)
        run: flutter build appbundle --release
        working-directory: ${{ env.FLUTTER_PROJECT_PATH }}
        
      # Ø¢Ù¾ APK Ø¨Ù„Úˆ Ú©Ø±Ù†Û’ Ú©Ø§ Ù…Ø±Ø­Ù„Û Ø¨Ú¾ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚº (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
      - name: ğŸ—ï¸ Build Android APK
        run: flutter build apk --release
        working-directory: ${{ env.FLUTTER_PROJECT_PATH }}
        
      # Ø¨Ù„Úˆ Ú©ÛŒ Ú¯Ø¦ÛŒ ÙØ§Ø¦Ù„Ø² Ú©Ùˆ Ø¢Ø±Ù¹ÛŒÙÛŒÚ©Ù¹ Ú©Û’ Ø·ÙˆØ± Ù¾Ø± Ø§Ù¾ Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº
      - name: ğŸš€ Upload AAB artifact
        uses: actions/upload-artifact@v4
        with:
          name: release-app-bundle
          path: ${{ env.FLUTTER_PROJECT_PATH }}/build/app/outputs/bundle/release/app-release.aab
          
      - name: ğŸš€ Upload APK artifact
        uses: actions/upload-artifact@v4
        with:
          name: release-apk
          path: ${{ env.FLUTTER_PROJECT_PATH }}/build/app/outputs/flutter-apk/app-release.apk
